# 秀丸へのmarkdownモード用のプラグインの提案

## 前置き

現行、何かサイトー企画さんの方で秀丸エディタに対して集中して取り込んでいる大きな機能があるなら
そちらを優先していただきたいですが、
「とりたててそういった大きな優先実装事項は存在しない」ということであれば、
大きなコンポーネントとなりますが、markdownモードを作ってみてはいかがですか程度の提案です。

´-`）.｡oO＜ 今サイトー企画さんではLSPを調べているんですかね？

「作ってみてはどうでしょう？」などと言いっぱなしもなんなので、
取り巻かれている現状などを踏まえた提案など添えてみます。

## テクニカル系ではない人をターゲットに据える

技術畑の人用のマークダウン支援というよりは
技術解説文用というよりは、「普通の文章用」あるいは「メモ用」といった方向にフォーカスを合わせる
まだマークダウンをあまり使っていない人が、秀丸で日本語文章を書く、
その延長線上でマークダウンが自然と取り扱えるようになればよいのかなと。

## Markdown Plugin の反響が良いようなら広げていける

文章という側面で言えば、マークダウンは電子書籍でもメジャーなePub、
あるいはPDFといったものとも相性がいいと言えます。
もしくは、関連性の深いGithub Pluginへと広げていけば相乗効果が狙えるでしょう。

## 秀丸とマークダウンはマッチするかしないか

### 秀丸は「日本語文章入力」においては依然人気あり

MarkdownはHTMLとは異なり「浅い段落とリスト項目を使った文章」「テーブルあり」「画像あり」程度ものが大半です。
日本語文章入力においては秀丸はVSCodeより選択されやすいわけだから、やりようによっては使われる機能を実装となるハズです。

### 秀丸は分轄表示を備えています

左をマークダウン編集エリア、右をプレビューエリアなどにする下地があります。
この入力スタイルはマークダウンエディタではやや古風ですがオーソドックスと言えます。。

### 秀丸にはファイルマネージャがあります

同じフォルダ内の別のマークダウンファイルをすぐに選択できる下地があり便利に機能します。

### 秀丸メールではすでにプラグインではあるものの、WebView2での実績があります

HTMLをレンダリング出来るプラグインを作れる下地があります。

### 秀丸は「ボタンメニュー」を備えています

秀丸は「プルダウンメニュー」を備えています。

### 秀丸の本体と切り離せるプラグイン機能がある

#### 最悪なくなる

マークダウンは時代を経る中で廃れて別の形態へと変化していく可能性も高いです。
本体に入れるのではなく(最悪はやめられる)プラグイン扱いにしたほうがいいとは思います。

マークダウン機能は、レンダリングにおいて外部コンポーネント依存せざるを得ないかもしれません。
(WZ Editor などは独自のレンダリングをしているようですが...)

#### プラグイン時に上部にボタン枠の追加

秀丸にはプラグインの機能があり、プラグイン時に上部にメニューを追加できます。
(URL欄を追加しているプラグインなどもある)


以上から、秀丸エディタにマークダウン編集閲覧機能を搭載することは相性が良いと思います。

## VSCodeとの差別化、VSCodeの弱点

私自身が6年くらいVSCode 1.0の頃から使っているので逆によくわかるんですが
VSCodeは キーバインドショートカット と コマンドパレット での操作に集約されているため
技術畑はないユーザーがこの操作でMarkdownを入力していくのは敷居が高いハズです。

Markdownのタグを支援するようなボタンを用意すれば大きく緩和できますが、
VSCodeを利用する層と噛み合わないため、当面はデフォルトでは実装されないでしょう。

マークダウンにテキスト入力のみで対応していたSAASやブログが近年、
WYSIWYGとテキストの両方のモード搭載、あるいはハイブリッド入力方式になってきていることからも
技術畑はない人々にまでMarkdownの使用の裾野を広がる際には、
テキストのみで入力では限界があることがわかります。

## 制作の方向性の提案

### 左テキスト・右プレビュー・上部にメニューボタン・テキスト選択時のみ出現するパネルボタンあり

　基本的なところではVSCodeに「Markdown all in one」の拡張機能と「Paste Image」を入れたような挙動。
　ここに「VSCodeでは突き放して捨てて」しまっている「非技術畑の人に寄り添う機能」を付けていく
　「Markdownボタン」を秀丸の上部メニューに並べたり、
　テキストを選択すると近くにそのシチュエーションでよく利用されるボタンのパネルが出るなど（→Milkdown参照)。

　左が編集エリア、右がプレビューエリア(プレビューは出す出さない自由）
　参考になるエディタやサービス
　　・ VSCode + Markdown All in One
　　・ GithubのPull Requestの画面(絞り込んだボタン)
　　・ Typora(マークダウンにはどのような機能があるのかメニューからわかる。
　　　　　　　WYSIWYGとテキスト入力とを融合するとこうなるというのもわかるがこの実装は敷居が高い)
　　・ Milkdownの画面(絞り込んだボタン)
　　・ (この他、各種Markdownが使えるようなSaaSやWordPressのマークダウン系プラグインなども上記４つのいずれかと類似します)

　(Typoraのような)テキストで入力すると即座にWYSIWIGになる、「テキストのタグの入力エリア＝レンダリングエリア」みたいなことは
　めちゃくちゃ実装コスト大きすぎるため、
　左はテキスト、右はライブビュー と一般的な形でよいかと。


### 実装するならこれは必須と思われる機能

- 右にビューワー。同期する。ビューワーの方をスクロールするとテキストエリアが合わせて移動、
  テキストエリアをスクロールすると、右のビューワーが合わせて移動
- テキストエリアで「編集している位置」に、右のライブビューの「見えてる位置」は追従するようにする（必須）
- リスト項目の文章を入力している際、改行すると次のリスト項目となる（ほぼ必須）
- リストが番号型なら、間に行をはさむと番号が自動的に再整理される。
- Github Flavored Markdown の範囲は対応。  
特にテーブルが使えない(標準の)Markdownだと使いみちがかなり限定されてしまう。(テーブルだけは必須)
- 直近のクリップボードがhttpプロトコルであった場合、テキストを選択しつつCTRL+Vを押すと、選択したテキストを対象のhttpプロトコルでリンクを貼る
- 画像のコピー＆ペーストに対応する。  
VSCodeのImage Pasteプラグインが参考となるが、それ以上にしたいところ。
 直近のクリップボードが画像イメージかもしくは画像ファイルなら、CTRL+Vで自動的にイメージタグとなる。
「クリップボードが画像イメージ」ペーストするとその場で画像タグを作成しそこに画像Markdown挿入。(VSCodeの「Image Paste」相当)
「クリップボードが画像ファイル」相対ディレクトリにできそうな範囲なら相対URL、そうでないなら絶対URLにして画像Markdown挿入。（これはほとんどのMarkdownエディタがやっていない）
「画像ファイルを編集テキストエリアの該当行へとドラッグ＆ドラップ」→ここまでできれば理想的。
- テーブルのプロトタイプボタン(列数の入力)、テーブルのフォーマットボタン
- テーブルのフォーマット。マークダウンのテーブルはテキストで見ると横幅がガタガタになる。これを整形する。
　　Markdownはレンダリング結果だけではなく、テキスト側を見ても文章やテーブルとしてわかりやすいことが求められるため。
　　(すでにテーブルMarkdownになっている範囲を選択して整形するのが良い。）
- CSSの外部適用。各要素をどのようにレンダリングするかカスタム出来ると理想  → (VSCodeの「Table Formatter」相当)
  - なくてもいいですが、その時はGithubのMarkdownからのレンダリング用CSSに近い見た目の方が違和感が少ないです。
    - GithubのMarkdownのCSSに近い見た目。
    - https://github.com/sindresorhus/github-markdown-css/blob/main/github-markdown-light.css
    - https://github.com/sindresorhus/github-markdown-css/blob/main/github-markdown-dark.css
　　　　　　　（一般的にはdarkではなくlightが標準とされている)
- テキスト選択中に頻繁に使う機能は、選択中のテキストに近い距離に別途ボタンを出す。（→Milkdownが参考となる)
- 「ブラウザで見る」「単一HTML化(持ち運びや簡単にブラウザで取り扱えるように)」「PDF化」「eBook化(ePub, mobi, PDF HTML)」

### 迷う機能

- 数式対応やUML等々は不要です。(→単発で数式やUMLだけ対応されていても意味がうすく、数式を使ったpythonやRやVSCodeなりがよい)
- MarkdownLint機能は常時適応だとうっとうしいかもしれない
- MarkdownLint機能自体はあったほうが良いと思うが、常時適応だとうっとうしいかもしれない
　　そんなキッチリしたLintに叶うMarkdownってあまり書かないし、Lintに従うと行が隙間だらけに


----------------------------------------------------------------------------
- 参考になるVSCodeプラグイン
	- Markdown Navigation
	- Markdown All in one
	- Markdown Math
